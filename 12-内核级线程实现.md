### 内核级线程实现
---
- 核心级线程的两套站，核心是内核栈
### 线程1
> 用户
>> 用户栈
>> 代码和数据
---
> 内核
>> 内核栈
>> 线程控制块
### 线程2
> 用户
>> 用户栈
>> 代码和数据
---
> 内核
>> 内核栈
>> 线程控制块
---
1. 用户栈到内核栈
2. 内核栈到线程控制块
3. 线程控制块到线程2控制块
4. 线程2控制块到线程2内核栈
5. 内核栈到线程2的用户栈
---
```C
main() {
    A();
    B();
}
A();
{
    fork();
}
```
- fork()是系统调用 会引起中断
---
- TR可找到当前进程的tss
---
> copy_process细节:创建栈
> 申请内存空间
> 创建TCB
> 创建内核栈和用户栈
> 填写两个stack
> 关联栈和TCB
